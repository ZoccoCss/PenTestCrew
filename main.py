from crewai import Crew
from agents import AIPenTestAgents
from tasks import AIPenTestTasks
from dotenv import load_dotenv
import os 

#Load Environment Variables
load_dotenv()

# Initialize the agents and tasks
agents = AIPenTestAgents()
tasks = AIPenTestTasks()

# Ask for the target and perform the scan
targetnet = input("Enter target network (x.x.x.x/y): ")
scanResults=os.popen('nmap '+targetnet+' -A --script vuln').read()
print(scanResults)

# Instantiate the agents
tester = agents.tester()
editor = agents.editor()

# Instantiate the tasks
Reconnaissance = tasks.Reconnaissance(tester, scanResults)
ResourceDevelopment=tasks.ResourceDevelopment(tester, [Reconnaissance] )
MakeReport=tasks.MakeReport(editor, [Reconnaissance, ResourceDevelopment])

#  Form the crew
crew = Crew(
    agents=[tester, editor ],
    tasks=[Reconnaissance, ResourceDevelopment, MakeReport ],
    verbose=2
)

# Kick off the crew's work
results = crew.kickoff()

# Print the results
print("Crew Work Results:")
print(results)    

